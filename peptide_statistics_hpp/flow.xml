<?xml version="1.0" encoding="ISO-8859-1" ?>
<flow name="peptide_statistics_hpp">
	<object name="workflowParameters"/>

    <object name="peptidelist"/>
    <object name="fastadb"/>
		<collection name="mztab"/>
		<collection name="spec_on_server"/>
		<collection name="library_output"/>
		<object name="synthetics"/>

		<object name="kb_pep"/>

	<collection name="parallel_params"/>
	<collection name="intermediate_protein_coverage"/>

    <collection name="intermediate_unique_peptide_coverage"/>

    <collection name="debug_protein_coverage"/>

    <object name="protein_coverage"/>
		<object name="novel_psms"/>
		<object name="novel_peptides"/>
    <object name="unique_peptides_list"/>
	<object name="library_coverage_summary_statistics"/>

	<collection name="peptide_coverage_merged_external"/>
	<collection name="novel_psms_w_cosine_external"/>
    <action name="begin">
        <output port="mztab"       			 collection="mztab"/>
				<output port="spec_on_server"       collection="spec_on_server"/>
        <output port="fastadb" 		  object="fastadb"/>
				<output port="synthetics" 		  object="synthetics"/>
        <output port="params" object="workflowParameters"/>
				<output port="peptide_coverage_merged_external"       			 collection="peptide_coverage_merged_external"/>
				<output port="novel_psms_w_cosine_external"       collection="novel_psms_w_cosine_external"/>
    </action>

		<action name="extract_peptides">
			<input   port="mztab"       			      collection="mztab"/>
			<input  port="params"             			object="workflowParameters"/>
			<output  port="peptidelist"             object="peptidelist"/>
			<output  port="library_output"          collection="library_output"/>
		</action>

		<action name="download_latest_kb">
			<input   port="params"       			    object="workflowParameters"/>
			<output  port="kb_pep"             		object="kb_pep"/>
		</action>

	<action name="protein_coverage_calculation_paramgeneration">
        <input  port="peptidelist"             object="peptidelist"/>
        <input  port="fastadb"             object="fastadb"/>
        <input  port="params"             object="workflowParameters"/>
        <output port="parallel_params"       collection="parallel_params"/>
    </action>

    <action name="protein_coverage_calculation_map" multiplicity="multiple" type="parallel">
		<input port="parallel_params"       collection="parallel_params"  transformation="unfolding"/>
        <input  port="peptidelist"             object="peptidelist"/>
        <input  port="fastadb"             object="fastadb"/>
        <input  port="params"             object="workflowParameters"/>
        <output port="intermediate_protein_coverage"       collection="intermediate_protein_coverage"/>
        <output port="debug_protein_coverage"       collection="debug_protein_coverage"/>
    </action>

    <action name="unique_peptide_calculation_map" multiplicity="multiple" type="parallel">
		<input port="parallel_params"       collection="parallel_params"  transformation="unfolding"/>
        <input  port="peptidelist"             object="peptidelist"/>
        <input  port="fastadb"             object="fastadb"/>
        <input  port="params"             object="workflowParameters"/>
        <output port="intermediate_unique_peptide_coverage"       collection="intermediate_unique_peptide_coverage"/>
    </action>

	<action name="protein_coverage_calculation_reduce">
		<input  port="peptidelist"             object="peptidelist"/>
        <input  port="fastadb"             object="fastadb"/>
        <input  port="params"             object="workflowParameters"/>
		<input port="intermediate_protein_coverage"       collection="intermediate_protein_coverage"/>
        <input port="intermediate_unique_peptide_coverage" collection="intermediate_unique_peptide_coverage"/>
        <output port="protein_coverage"       object="protein_coverage"/>
        <output port="unique_peptides_list"       object="unique_peptides_list"/>
        <output port="library_coverage_summary_statistics"       object="library_coverage_summary_statistics"/>
    </action>


	<collection name="intermediate_peptide_coverage"/>
	<action name="peptide_stats_coverage_map" multiplicity="multiple" type="parallel">
		<input port="parallel_params"       collection="parallel_params"  transformation="unfolding"/>
        <input  port="peptidelist"             object="peptidelist"/>
        <input  port="fastadb"             object="fastadb"/>
        <input  port="params"             object="workflowParameters"/>
        <output port="intermediate_peptide_coverage"       collection="intermediate_peptide_coverage"/>
    </action>

	<object name="peptide_coverage_merged"/>
		<action name="peptide_stats_coverage_reduce">
		<input port="input_folder"       collection="intermediate_peptide_coverage"/>
        <output port="output_file"       object="peptide_coverage_merged"/>
    </action>

		<action name="merge_kb_coverage">
			<input   port="spec_on_server"      collection="spec_on_server"/>
			<input   port="mztab"      					collection="mztab"/>
			<output  port="novel_psms"          object="novel_psms"/>
		</action>

		<collection name="novel_psms_p"/>
		<collection name="jobs"/>

		<action name="calculate_cosine_p">
			<input   port="novel_psms"          object="novel_psms"/>
			<output  port="novel_psms_p"          collection="novel_psms_p"/>
			<output  port="jobs"          collection="jobs"/>

		</action>

		<collection name="novel_psms_w_cosine"/>

		<action name="calculate_cosine" multiplicity="multiple" type="parallel">
			<input   port="jobs"          							object="jobs"  transformation="unfolding"/>
			<input   port="novel_psms_p"          			collection="novel_psms_p"/>
			<input   port="synthetics"          				object="synthetics"/>
			<output  port="novel_psms_w_cosine"         collection="novel_psms_w_cosine"/>
		</action>

		<object name="novel_proteins_w_cosine"/>
		<object name="novel_peptides_w_cosine"/>
		<object name="merged_novel_psms_w_cosine"/>

		<action name="peptide_protein_cosine">
			<input   port="kb_pep"       			    object="kb_pep"/>
			<input   port="novel_psms_w_cosine"          collection="novel_psms_w_cosine"/>
			<input   port="peptide_coverage_merged"   object="peptide_coverage_merged"/>
			<input   port="novel_psms_w_cosine_external"       collection="novel_psms_w_cosine_external"/>
			<input   port="peptide_coverage_merged_external"   collection="peptide_coverage_merged_external"/>
			<output  port="novel_proteins_w_cosine"      object="novel_proteins_w_cosine"/>
			<output  port="novel_peptides_w_cosine"      object="novel_peptides_w_cosine"/>
			<output  port="merged_novel_psms_w_cosine"   object="merged_novel_psms_w_cosine"/>
		</action>

    <action name="end">
        <input port="unique_peptides_list"       object="unique_peptides_list"/>
        <input port="protein_coverage" object="protein_coverage"/>
				<input port="library_coverage_summary_statistics" object="library_coverage_summary_statistics"/>
        <input port="debug_protein_coverage" collection="debug_protein_coverage"/>
				<input port="library_output" collection="library_output"/>
				<input port="peptide_coverage_merged" object="peptide_coverage_merged"/>
				<input port="novel_proteins_w_cosine" object="novel_proteins_w_cosine"/>
				<input port="merged_novel_psms_w_cosine" object="merged_novel_psms_w_cosine"/>
				<input port="novel_peptides_w_cosine" object="novel_peptides_w_cosine"/>
		</action>
</flow>
